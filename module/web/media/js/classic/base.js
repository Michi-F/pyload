{% autoescape true %}
var LoadJsonToContent,clear_captcha,humanFileSize,load_captcha,on_captcha_click,parseUri,root,set_captcha,submit_captcha;root=this,humanFileSize=function(e){var t,a,c,n;return a=new Array("B","KiB","MiB","GiB","TiB","PiB"),n=Math.log(e)/Math.log(1024),c=Math.floor(n),t=Math.pow(1024,c),0===e?"0 B":Math.round(100*e/t)/100+" "+a[c]},parseUri=function(){var e,t,a,c,n,o,r;if(e=$("add_links").value,a=new RegExp("(ht|f)tp(s?)://[a-zA-Z0-9-./?=_&%#]+[<| |\"|'|\r|\n|\t]{1}","g"),null!==(n=e.match(a))){for(c="",o=0,r=n.length;o<r;o++)-1!==(t=n[o]).indexOf(" ")?c+=t.replace(" "," \n"):-1!==t.indexOf("\t")?c+=t.replace("\t"," \n"):-1!==t.indexOf("\r")?c+=t.replace("\r"," \n"):-1!==t.indexOf('"')?c+=t.replace('"'," \n"):-1!==t.indexOf("<")?c+=t.replace("<"," \n"):-1!==t.indexOf("'")?c+=t.replace("'"," \n"):c+=t.replace("\n"," \n");return $("add_links").value=c}},Array.prototype.remove=function(e,t){var a,c;return a=this.slice((t||e)+1||this.length),this.length=null!=(c=e<0)?c:this.length+{from:e},0===this.length?[]:this.push.apply(this,a)},document.addEvent("domready",function(){return root.notify=new Purr({mode:"top",position:"center"}),root.captchaBox=new MooDialog({destroyOnHide:!1}),root.captchaBox.setContent($("cap_box")),root.addBox=new MooDialog({destroyOnHide:!1}),root.addBox.setContent($("add_box")),$("add_form").onsubmit=function(){return $("add_form").target="upload_target",""===$("add_name").value&&""===$("add_file").value?(alert("Please Enter a packagename."),!1):(root.addBox.close(),!0)},$("add_reset").addEvent("click",function(){return root.addBox.close()}),$("action_add").addEvent("click",function(){return $("add_form").reset(),root.addBox.open()}),$("action_play").addEvent("click",function(){return new Request({method:"get",url:"/api/unpauseServer"}).send()}),$("action_cancel").addEvent("click",function(){return new Request({method:"get",url:"/api/stopAllDownloads"}).send()}),$("action_stop").addEvent("click",function(){return new Request({method:"get",url:"/api/pauseServer"}).send()}),$("cap_info").addEvent("click",function(){return load_captcha("get",""),root.captchaBox.open()}),$("cap_reset").addEvent("click",function(){return root.captchaBox.close()}),$("cap_form").addEvent("submit",function(e){return submit_captcha(),e.stop()}),$("cap_positional").addEvent("click",on_captcha_click),new Request.JSON({url:"/json/status",onSuccess:LoadJsonToContent,secure:!1,async:!0,initialDelay:0,delay:4e3,limit:3e3}).startTimer()}),LoadJsonToContent=function(e){return $("speed").set("text",humanFileSize(e.speed)+"/s"),$("aktiv").set("text",e.active),$("aktiv_from").set("text",e.queue),$("aktiv_total").set("text",e.total),e.captcha?"inline"!==$("cap_info").getStyle("display")&&($("cap_info").setStyle("display","inline"),root.notify.alert("New Captcha Request",{className:"notify"})):$("cap_info").setStyle("display","none"),e.download?($("time").set("text"," on"),$("time").setStyle("background-color","#8ffc25")):($("time").set("text"," off"),$("time").setStyle("background-color","#fc6e26")),e.reconnect?($("reconnect").set("text"," on"),$("reconnect").setStyle("background-color","#8ffc25")):($("reconnect").set("text"," off"),$("reconnect").setStyle("background-color","#fc6e26")),null};var recaptchaV2ResponseGrabber=null;recaptchaV2InteractiveIframeReadyFunction=function(){$("cap_title").set("text",""),$("interactiveCaptchaIframeId").setStyle("display","block")},set_captcha=function(e){return clear_captcha(),$("cap_id").set("value",e.id),"textual"===e.result_type?($("cap_textual_img").set("src",e.src),$("cap_title").set("text","Please read the text on the captcha."),$("cap_submit").setStyle("display","inline"),$("cap_textual").setStyle("display","block"),!0):"positional"===e.result_type?($("cap_positional_img").set("src",e.src),$("cap_title").set("text","Please click on the right captcha position."),$("cap_positional").setStyle("display","block"),!0):void("interactive"===e.result_type&&(null==recaptchaV2ResponseGrabber&&(recaptchaV2ResponseGrabber=new recaptchaV2InteractiveResponseGrabber("interactiveCaptchaIframeId","interactiveCaptchaIframeName",submit_captcha,recaptchaV2InteractiveIframeReadyFunction)),interactiveCaptchaRequest=JSON.parse(e.src),void 0!=interactiveCaptchaRequest.url&&void 0!=interactiveCaptchaRequest.sitekey&&interactiveCaptchaRequest.url.indexOf("http")>=0&&interactiveCaptchaRequest.sitekey.length>0&&($("cap_title").innerHTML='{{_("The captcha may take a few seconds to load.")}}<br/>{{_("Note: to solve this interactive captcha, please install the Tampermonkey add-on in your browser and add the pyload userscript.")}}',recaptchaV2ResponseGrabber.grabRecaptchaV2InteractiveResponse(interactiveCaptchaRequest.url,interactiveCaptchaRequest.sitekey),$("cap_interactive").setStyle("display","block"))))},load_captcha=function(e,t){return new Request.JSON({url:"/json/set_captcha",onSuccess:function(e){return set_captcha(e),e.captcha?void 0:clear_captcha()},secure:!1,async:!0,method:e}).send(t)},clear_captcha=function(){return $("cap_textual").setStyle("display","none"),$("cap_textual_img").set("src",""),$("cap_positional").setStyle("display","none"),$("cap_positional_img").set("src",""),$("cap_submit").setStyle("display","none"),$("cap_title").set("text","No Captchas to read."),$("cap_interactive").setStyle("display","none"),$("interactiveCaptchaIframeId").set("src","about:blank"),$("interactiveCaptchaIframeId").setStyle("display","none"),recaptchaV2ResponseGrabber&&(recaptchaV2ResponseGrabber.clearEventlisteners(),interactiveLinkGrabber=null),!0},submit_captcha=function(result=undefined){return void 0==result?load_captcha("post","cap_id="+$("cap_id").get("value")+"&cap_result="+$("cap_result").get("value")):load_captcha("post","cap_id="+$("cap_id").get("value")+"&cap_result="+result),$("cap_result").set("value",""),!1},on_captcha_click=function(e){var t,a,c;return t=e.target.getPosition(),a=e.page.x-t.x,c=e.page.y-t.y,$("cap_result").value=a+","+c,submit_captcha()};
{% endautoescape %}